(self["webpackChunkgutar"]=self["webpackChunkgutar"]||[]).push([[339],{1684:function(t,e,n){n(4114),n(6573),n(8100),n(7936),n(7467),n(4732),n(9577),n(4603),n(7566),n(8721),function(e,n){t.exports=n()}(0,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){"use strict";function i(t,e,n){for(var i=0;i<n.length;i++)t.setUint8(e+i,n.charCodeAt(i))}Object.defineProperty(e,"__esModule",{value:!0}),e.compress=function(t,e,n){for(var i=e/n,o=Math.max(i,1),r=t.left,a=t.right,s=Math.floor((r.length+a.length)/i),u=new Float32Array(s),l=0,c=0;l<s;){var f=Math.floor(c);u[l]=r[f],l++,a.length&&(u[l]=a[f],l++),c+=o}return u},e.encodePCM=function(t,e,n){void 0===n&&(n=!0);var i=0,o=t.length*(e/8),r=new ArrayBuffer(o),a=new DataView(r);if(8===e)for(var s=0;s<t.length;s++,i++){var u=(l=Math.max(-1,Math.min(1,t[s])))<0?128*l:127*l;u=+u+128,a.setInt8(i,u)}else for(s=0;s<t.length;s++,i+=2){var l=Math.max(-1,Math.min(1,t[s]));a.setInt16(i,l<0?32768*l:32767*l,n)}return a},e.encodeWAV=function(t,e,n,o,r,a){void 0===a&&(a=!0);var s=n>e?e:n,u=r,l=new ArrayBuffer(44+t.byteLength),c=new DataView(l),f=o,h=0;i(c,h,"RIFF"),h+=4,c.setUint32(h,36+t.byteLength,a),i(c,h+=4,"WAVE"),i(c,h+=4,"fmt "),h+=4,c.setUint32(h,16,a),h+=4,c.setUint16(h,1,a),h+=2,c.setUint16(h,f,a),h+=2,c.setUint32(h,s,a),h+=4,c.setUint32(h,f*s*(u/8),a),h+=4,c.setUint16(h,f*(u/8),a),h+=2,c.setUint16(h,u,a),i(c,h+=2,"data"),h+=4,c.setUint32(h,t.byteLength,a),h+=4;for(var p=0;p<t.byteLength;)c.setUint8(h,t.getUint8(p)),h++,p++;return c}},function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),a=n(0),s=n(3),u=function(t){function e(e){void 0===e&&(e={});var n=t.call(this,e)||this;return n.isrecording=!1,n.ispause=!1,n.isplaying=!1,n}return o(e,t),e.prototype.setOption=function(t){void 0===t&&(t={}),this.setNewOption(t)},e.prototype.start=function(){return this.isrecording?Promise.reject():(this.isrecording=!0,this.startRecord())},e.prototype.pause=function(){this.isrecording&&!this.ispause&&(this.ispause=!0,this.pauseRecord())},e.prototype.resume=function(){this.isrecording&&this.ispause&&(this.ispause=!1,this.resumeRecord())},e.prototype.stop=function(){this.isrecording&&(this.isrecording=!1,this.ispause=!1,this.stopRecord())},e.prototype.play=function(){this.stop(),this.isplaying=!0,this.onplay&&this.onplay(),s.default.addPlayEnd(this.onplayend);var t=this.getWAV();t.byteLength>44&&s.default.play(t.buffer)},e.prototype.getPlayTime=function(){return s.default.getPlayTime()},e.prototype.pausePlay=function(){!this.isrecording&&this.isplaying&&(this.isplaying=!1,this.onpauseplay&&this.onpauseplay(),s.default.pausePlay())},e.prototype.resumePlay=function(){this.isrecording||this.isplaying||(this.isplaying=!0,this.onresumeplay&&this.onresumeplay(),s.default.resumePlay())},e.prototype.stopPlay=function(){this.isrecording||(this.isplaying=!1,this.onstopplay&&this.onstopplay(),s.default.stopPlay())},e.prototype.destroy=function(){return s.default.destroyPlay(),this.destroyRecord()},e.prototype.getRecordAnalyseData=function(){return this.getAnalyseData()},e.prototype.getPlayAnalyseData=function(){return s.default.getAnalyseData()},e.prototype.getPCM=function(){this.stop();var t=this.getData();return t=a.compress(t,this.inputSampleRate,this.outputSampleRate),a.encodePCM(t,this.oututSampleBits,this.littleEdian)},e.prototype.getPCMBlob=function(){return new Blob([this.getPCM()])},e.prototype.downloadPCM=function(t){void 0===t&&(t="recorder");var e=this.getPCMBlob();r.downloadPCM(e,t)},e.prototype.getWAV=function(){var t=this.getPCM();return a.encodeWAV(t,this.inputSampleRate,this.outputSampleRate,this.config.numChannels,this.oututSampleBits,this.littleEdian)},e.prototype.getWAVBlob=function(){return new Blob([this.getWAV()],{type:"audio/wav"})},e.prototype.downloadWAV=function(t){void 0===t&&(t="recorder");var e=this.getWAVBlob();r.downloadWAV(e,t)},e.prototype.download=function(t,e,n){r.download(t,e,n)},e.prototype.getChannelData=function(){var t=this.getPCM(),e=t.byteLength,n=this.littleEdian,i={left:null,right:null};if(2===this.config.numChannels){var o=new DataView(new ArrayBuffer(e/2)),r=new DataView(new ArrayBuffer(e/2));if(16===this.config.sampleBits)for(var a=0;a<e/2;a+=2)o.setInt16(a,t.getInt16(2*a,n),n),r.setInt16(a,t.getInt16(2*a+2,n),n);else for(a=0;a<e/2;a+=2)o.setInt8(a,t.getInt8(2*a)),r.setInt8(a,t.getInt8(2*a+1));i.left=o,i.right=r}else i.left=t;return i},e}(n(5).default);e.default=u},function(t,e,n){"use strict";function i(t,e,n){var i=document.createElement("a");i.href=window.URL.createObjectURL(t),i.download=e+"."+n,i.click()}Object.defineProperty(e,"__esModule",{value:!0}),e.downloadWAV=function(t,e){void 0===e&&(e="recorder"),i(t,e,"wav")},e.downloadPCM=function(t,e){void 0===e&&(e="recorder"),i(t,e,"pcm")},e.download=function(t,e,n){return i(t,e,n)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(4),o=null,r=0,a=0,s=null,u=null,l=null,c=!1,f=0,h=function(){};function p(){return c=!1,s.decodeAudioData(l.slice(0),(function(t){(o=s.createBufferSource()).onended=function(){c||(f=s.currentTime-a+r,h())},o.buffer=t,o.connect(u),u.connect(s.destination),o.start(0,r),a=s.currentTime}),(function(t){i.throwError(t)}))}function d(){o&&(o.stop(),o=null)}var y=function(){function t(){}return t.play=function(t){return s||(s=new(window.AudioContext||window.webkitAudioContext),(u=s.createAnalyser()).fftSize=2048),this.stopPlay(),l=t,f=0,p()},t.pausePlay=function(){d(),r+=s.currentTime-a,c=!0},t.resumePlay=function(){return p()},t.stopPlay=function(){r=0,l=null,d()},t.destroyPlay=function(){this.stopPlay()},t.getAnalyseData=function(){var t=new Uint8Array(u.frequencyBinCount);return u.getByteTimeDomainData(t),t},t.addPlayEnd=function(t){void 0===t&&(t=function(){}),h=t},t.getPlayTime=function(){var t=c?r:s.currentTime-a+r;return f||t},t}();e.default=y},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.throwError=function(t){throw new Error(t)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),o=function(){function t(e){void 0===e&&(e={}),this.size=0,this.lBuffer=[],this.rBuffer=[],this.tempPCM=[],this.inputSampleBits=16,this.fileSize=0,this.duration=0,this.needRecord=!0;var n,i=new(window.AudioContext||window.webkitAudioContext);this.inputSampleRate=i.sampleRate,this.setNewOption(e),this.littleEdian=(n=new ArrayBuffer(2),new DataView(n).setInt16(0,256,!0),256===new Int16Array(n)[0]),t.initUserMedia()}return t.prototype.setNewOption=function(t){void 0===t&&(t={}),this.config={sampleBits:~[8,16].indexOf(t.sampleBits)?t.sampleBits:16,sampleRate:~[8e3,11025,16e3,22050,24e3,44100,48e3].indexOf(t.sampleRate)?t.sampleRate:this.inputSampleRate,numChannels:~[1,2].indexOf(t.numChannels)?t.numChannels:1},this.outputSampleRate=this.config.sampleRate,this.oututSampleBits=this.config.sampleBits},t.prototype.startRecord=function(){var t=this;return this.context&&this.destroyRecord(),this.initRecorder(),navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){t.audioInput=t.context.createMediaStreamSource(e),t.stream=e})).then((function(){t.audioInput.connect(t.analyser),t.analyser.connect(t.recorder),t.recorder.connect(t.context.destination)}))},t.prototype.pauseRecord=function(){this.needRecord=!1},t.prototype.resumeRecord=function(){this.needRecord=!0},t.prototype.stopRecord=function(){this.audioInput&&this.audioInput.disconnect(),this.source&&this.source.stop(),this.recorder.disconnect(),this.analyser.disconnect(),this.needRecord=!0},t.prototype.destroyRecord=function(){return this.clearRecordStatus(),this.stopStream(),this.closeAudioContext()},t.prototype.getAnalyseData=function(){var t=new Uint8Array(this.analyser.frequencyBinCount);return this.analyser.getByteTimeDomainData(t),t},t.prototype.getData=function(){return this.flat()},t.prototype.clearRecordStatus=function(){this.lBuffer.length=0,this.rBuffer.length=0,this.size=0,this.fileSize=0,this.PCM=null,this.audioInput=null,this.duration=0},t.prototype.flat=function(){var t=null,e=new Float32Array(0);1===this.config.numChannels?t=new Float32Array(this.size):(t=new Float32Array(this.size/2),e=new Float32Array(this.size/2));for(var n=0,i=0;i<this.lBuffer.length;i++)t.set(this.lBuffer[i],n),n+=this.lBuffer[i].length;for(n=0,i=0;i<this.rBuffer.length;i++)e.set(this.rBuffer[i],n),n+=this.rBuffer[i].length;return{left:t,right:e}},t.prototype.initRecorder=function(){var t=this;this.clearRecordStatus(),this.context=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.context.createAnalyser(),this.analyser.fftSize=2048;var e=this.context.createScriptProcessor||this.context.createJavaScriptNode;this.recorder=e.apply(this.context,[4096,this.config.numChannels,this.config.numChannels]),this.recorder.onaudioprocess=function(e){if(t.needRecord){var n,i=e.inputBuffer.getChannelData(0),o=null;t.lBuffer.push(new Float32Array(i)),t.size+=i.length,2===t.config.numChannels&&(o=e.inputBuffer.getChannelData(1),t.rBuffer.push(new Float32Array(o)),t.size+=o.length),t.fileSize=Math.floor(t.size/Math.max(t.inputSampleRate/t.outputSampleRate,1))*(t.oututSampleBits/8),n=100*Math.max.apply(Math,i),t.duration+=4096/t.inputSampleRate,t.onprocess&&t.onprocess(t.duration),t.onprogress&&t.onprogress({duration:t.duration,fileSize:t.fileSize,vol:n})}}},t.prototype.stopStream=function(){this.stream&&this.stream.getTracks&&(this.stream.getTracks().forEach((function(t){return t.stop()})),this.stream=null)},t.prototype.closeAudioContext=function(){return this.context&&this.context.close&&"closed"!==this.context.state?this.context.close():new Promise((function(t){t()}))},t.initUserMedia=function(){void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(t){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return e?new Promise((function(n,i){e.call(navigator,t,n,i)})):Promise.reject(new Error("浏览器不支持 getUserMedia !"))})},t.prototype.transformIntoPCM=function(t,e){var n=new Float32Array(t),o=new Float32Array(e),r=i.compress({left:n,right:o},this.inputSampleRate,this.outputSampleRate);return i.encodePCM(r,this.oututSampleBits,this.littleEdian)},t.getPermission=function(){return this.initUserMedia(),navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){t&&t.getTracks().forEach((function(t){return t.stop()}))}))},t}();e.default=o}]).default}))},5055:function(t,e,n){t.exports=n(1684)},4339:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return m}});n(4114),n(6573),n(8100),n(7936),n(7467),n(4732),n(9577);var i=n(6768),o=n(4232),r=n(144),a=n(5055),s=n.n(a),u=n(686);const l=t=>((0,i.Qi)("data-v-a84808be"),t=t(),(0,i.jt)(),t),c={class:"note-line"},f=l((()=>(0,i.Lk)("span",null,"已识别强音音标:",-1))),h={class:"note-line"},p=l((()=>(0,i.Lk)("span",null,"持续音标（>=0.1s）:",-1)));var d={__name:"index",setup(t){const e=(0,r.Kh)({animationEnable:!0,highFrequencyNoteMap:{}}),n=(0,r.KR)();let a;const l=()=>{if(a&&e.animationEnable?(a.pause(),e.animationEnable=!1):a&&!e.animationEnable&&(a.resume(),e.animationEnable=!0),void 0===a){a=new(s())({sampleBits:8,sampleRate:16e3,numChannels:1});const t=n.value.getContext("2d");a.start().then((function(){let i=1;function o(){let r=new Uint8Array(a.analyser.frequencyBinCount);a.analyser.getByteFrequencyData(r);const s=n.value.width,u=n.value.height;if(requestAnimationFrame(o),!e.animationEnable)return;i+=1,100===i&&console.log(r),t.fillStyle="rgb(232,232,232)",t.fillRect(0,0,s,u),t.lineWidth=2,t.strokeStyle="rgb(149,209,255)",t.beginPath();let l=1*s/r.length,c=0,f=0,h=[];for(let n=0;n<r.length;n++){const i=r[n],o=2e4*(n+1)/1024,a=d(o);(i>200||i>128&&void 0!==e.highFrequencyNoteMap[a])&&h.push(n),i>f&&(f=i);let s=i/256,p=u-s*u;t.moveTo(c,u),t.lineTo(c,p),c+=l}t.stroke(),t.beginPath(),t.strokeStyle="rgb(22,141,255)";let p={};const y=(new Date).getTime();for(let e=0;e<h.length;e++){const n=h[e],i=u-u*r[n]/256;t.moveTo(l*n,u),t.lineTo(l*n,i);const o=2e4*(n+1)/1024,a=d(o);void 0!==a&&void 0===p[a]&&(p[a]={beginTime:y,continueTime:0})}t.stroke();for(const t in p){const n=e.highFrequencyNoteMap[t];let i=p[t];void 0!==n&&(i.beginTime=n.beginTime,i.continueTime=y-n.beginTime)}e.highFrequencyNoteMap=p}o()}))}},d=t=>{let e;for(let n=0;n<u.noteMap.length;n++)if(Math.abs(u.noteMap[n].f-t)<u.noteMap[n].f/20){e=u.noteMap[n].k;break}return e};return(t,r)=>((0,i.uX)(),(0,i.CE)("div",null,[(0,i.Lk)("div",null,[(0,i.Lk)("canvas",{style:{width:"400px",height:"200px"},ref_key:"canvasRef",ref:n},null,512)]),(0,i.Lk)("div",c,[f,((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.highFrequencyNoteMap,((t,e)=>((0,i.uX)(),(0,i.CE)("span",null,(0,o.v_)(e),1)))),256))]),(0,i.Lk)("div",h,[p,((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.highFrequencyNoteMap,((t,e)=>((0,i.uX)(),(0,i.CE)("span",null,[t.continueTime>=100?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.eW)((0,o.v_)(e)+"、",1)],64)):(0,i.Q3)("",!0)])))),256))]),(0,i.Lk)("div",null,[(0,i.Lk)("button",{onClick:l},"测试麦克风")])]))}},y=n(1241);const g=(0,y.A)(d,[["__scopeId","data-v-a84808be"]]);var m=g},2812:function(t){"use strict";var e=TypeError;t.exports=function(t,n){if(t<n)throw new e("Not enough arguments");return t}},4603:function(t,e,n){"use strict";var i=n(6840),o=n(9504),r=n(655),a=n(2812),s=URLSearchParams,u=s.prototype,l=o(u.append),c=o(u["delete"]),f=o(u.forEach),h=o([].push),p=new s("a=1&a=2&b=3");p["delete"]("a",1),p["delete"]("b",void 0),p+""!=="a=2"&&i(u,"delete",(function(t){var e=arguments.length,n=e<2?void 0:arguments[1];if(e&&void 0===n)return c(this,t);var i=[];f(this,(function(t,e){h(i,{key:e,value:t})})),a(e,1);var o,s=r(t),u=r(n),p=0,d=0,y=!1,g=i.length;while(p<g)o=i[p++],y||o.key===s?(y=!0,c(this,o.key)):d++;while(d<g)o=i[d++],o.key===s&&o.value===u||l(this,o.key,o.value)}),{enumerable:!0,unsafe:!0})},7566:function(t,e,n){"use strict";var i=n(6840),o=n(9504),r=n(655),a=n(2812),s=URLSearchParams,u=s.prototype,l=o(u.getAll),c=o(u.has),f=new s("a=1");!f.has("a",2)&&f.has("a",void 0)||i(u,"has",(function(t){var e=arguments.length,n=e<2?void 0:arguments[1];if(e&&void 0===n)return c(this,t);var i=l(this,t);a(e,1);var o=r(n),s=0;while(s<i.length)if(i[s++]===o)return!0;return!1}),{enumerable:!0,unsafe:!0})},8721:function(t,e,n){"use strict";var i=n(3724),o=n(9504),r=n(2106),a=URLSearchParams.prototype,s=o(a.forEach);i&&!("size"in a)&&r(a,"size",{get:function(){var t=0;return s(this,(function(){t++})),t},configurable:!0,enumerable:!0})}}]);
//# sourceMappingURL=339.dcfd9b24.js.map